# Claude Extended Thinking

Extended thinking gives Claude 3.7 Sonnet enhanced reasoning capabilities for complex tasks, while providing transparency into its step-by-step thought process.

## How Extended Thinking Works

When enabled, Claude creates thinking content blocks that show its internal reasoning. Claude incorporates insights from this reasoning before crafting a final response.

The API response includes both thinking and text content blocks.

## Implementing Extended Thinking

Add the thinking parameter with a specified token budget to your API request:

```shell
curl https://api.anthropic.com/v1/messages \
     --header "x-api-key: $ANTHROPIC_API_KEY" \
     --header "anthropic-version: 2023-06-01" \
     --header "content-type: application/json" \
     --data \
'{
    "model": "claude-3-7-sonnet-20250219",
    "max_tokens": 20000,
    "thinking": {
        "type": "enabled",
        "budget_tokens": 16000
    },
    "messages": [
        {
            "role": "user",
            "content": "Are there an infinite number of prime numbers such that n mod 4 == 3?"
        }
    ]
}'
```

The response includes both thinking and text blocks:

```json
{
    "content": [
        {
            "type": "thinking",
            "thinking": "To approach this, let's think about what we know about prime numbers...",
            "signature": "zbbJhbGciOiJFU8zI1NiIsImtakcjsu38219c0.eyJoYXNoIjoiYWJjMTIzIiwiaWFxxxjoxNjE0NTM0NTY3fQ...."
        },
        {
            "type": "text",
            "text": "Yes, there are infinitely many prime numbers such that..."
        }
    ]
}
```

## Understanding Thinking Blocks

Thinking blocks contain a signature field that verifies they were generated by Claude. When streaming, the signature is added via signature_delta inside a content_block_delta event.

Occasionally, Claude's internal reasoning may be flagged by safety systems, resulting in redacted_thinking blocks:

```json
{
  "content": [
    {
      "type": "thinking",
      "thinking": "Let me analyze this step by step...",
      "signature": "WaUjzkypQ2mUEVM36O2TxuC06KN8xyfbJwyem2dw3URve/op91XWHOEBLLqIOMfFG/UvLEczmEsUjavL...."
    },
    {
      "type": "redacted_thinking",
      "data": "EmwKAhgBEgy3va3pzix/LafPsn4aDFIT2Xlxh0L5L8rLVyIwxtE3rAFBa8cr3qpP..."
    },
    {
      "type": "text",
      "text": "Based on my analysis..."
    }
  ]
}
```

## Important Considerations

- Minimum budget is 1,024 tokens
- Thinking tokens count as output tokens and are billed accordingly
- Not compatible with temperature, top_p, or top_k modifications
- Previous turn thinking blocks are stripped and not counted toward context window
- When using with tool use, thinking blocks must be preserved for reasoning continuity

## Extended Output Capabilities

Claude 3.7 Sonnet supports up to 128K output tokens with the anthropic-beta header:

```shell
curl https://api.anthropic.com/v1/messages \
     --header "x-api-key: $ANTHROPIC_API_KEY" \
     --header "anthropic-version: 2023-06-01" \
     --header "anthropic-beta: output-128k-2025-02-19" \
     --header "content-type: application/json" \
     --data \
'{
    "model": "claude-3-7-sonnet-20250219",
    "max_tokens": 128000,
    "thinking": {
        "type": "enabled",
        "budget_tokens": 32000
    },
    "messages": [
        {
            "role": "user",
            "content": "Generate a comprehensive analysis of..."
        }
    ],
    "stream": true
}'
```

## Tips for Best Results

- Start with larger thinking budgets (16,000+ tokens) for complex tasks
- Experiment with different budget settings for optimal performance
- Use for tasks that benefit from step-by-step reasoning (math, coding, analysis)
- Account for extended response times when thinking is enabled